#Краткий анализ легаси-кода и выполненный рефакторинг.

##Обнаруженные проблемы в исходном коде OrderProcessor:
Смешанная логика в одном методе
Метод ProcessOrder содержал проверки, побочные эффекты, обработку ошибок и бизнес-логику одновременно, что ухудшало читаемость.
Жесткие зависимости от IDatabase и IEmailService
В конструкторе не было проверки входящих зависимостей, что позволяло создать объект с null и получить ошибку в рантайме.
Неявные бизнес-правила
Логика отправки email (только при сумме > 100) была "спрятана" в середине метода и не выделена.
Дублирование и пересечение уровней ответственности
Проверка подключения к базе была смешана с логикой обработки заказа.
Слабая структурированность кода
Отсутствовали вспомогательные методы, из-за чего код был трудно расширять и поддерживать.

##Как рефакторинг устранил проблемы:
Метод ProcessOrder разделён на небольшие функции
Выделены методы:
IsOrderAmountValid()
EnsureDatabaseConnected()
SaveOrder()
SendEmailIfNeeded()
MarkOrderProcessed()

Это улучшило читаемость и упростило понимание логики.
Добавлены проверки зависимостей в конструкторе
Теперь объект невозможно создать с null-сервисами, что делает код безопаснее.
Логика отправки email вынесена в отдельный метод
Бизнес-правило стало явно отражено в коде.

Уменьшена вложенность и использован ранний возврат
Это упростило основной метод и сделало его поведение прозрачным.

Полностью сохранено оригинальное поведение
Все тесты, написанные до рефакторинга, проходят успешно, что подтверждает корректность изменений.
